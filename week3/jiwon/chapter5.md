노션: https://www.notion.so/5-2afa3c4c42a480e8b49bece38587d998?source=copy_link

## 해시 키 refrash 문제

→ 서버 풀의 크기가 고정되어 있을떄는 잘 동작하지만, 기존 서버가 삭제되면 문제가 생기게 된다.

**안정 해시**는 이 문제를 해결한다.

## 인정 해시

![image.png](attachment:9231bb81-d224-4da4-962b-afb833e0cb0b:image.png)

- 해시 테이블 크기가 조정될 떄 평균적으로 오직 k/n개의 키만 재배치하는 해시 기술 (k = 키의 개수, n= 슬롯의 개수)
- 해시 공간의 시작과 끝을 이어서 일종의 고리(ring)을 만든 후, 해시 공간 위에 노드들을 배치한다

## 안정 해시 알고리즘

1. 서버와 키를 균등 분포 해시 함수를 사용해 해시 링에 배치한다.
2. 키의 위치에서 링으르 시계방향으로 탐색하다 만나는 최초의 서버가 키가 저장될 서버이다.

그러나 문제점 ..

- 서버가 추가되거나 삭제되는 상황을 감안하면 파티션 크기를 균등하게 유지하는게 불가능해짐!

![image.png](attachment:81c44897-9045-4199-9da0-a5ad0d1a9ac8:image.png)

- 키의 균등 분포를 달성하기가 어렵다

![image.png](attachment:1a8b099b-5c51-4f2b-aaa9-82f0de95c7a6:image.png)

→ 이 문제를 해결하기 위해 **가상 노드**를 사용한다.

## 가상 노드 (virtual node)

- 가상 노드는 내부적으로 물리 노드의 해시값을 가리킨다.
- 본체인 물리 노드는 해시 링 위에 배치되지 않고, 복제된 가상 노드들만이 해시 링 위에서 트래픽을 기다리고 있다.
- 트래픽이 가상 노드에 할당되면 내부에 존재하는 실제 노드의 해시 값으로 라우팅되는 원리이다.

가상 노드의 개수를 늘리면 키의 분포는 점점 더 균등해진다.

그러나 가상노드를 저장한 메모리 문제도 있기 때문에, 타협적 결정이 필요하다.

안정해시의 이점

- 서버가 추가되거나 삭제될 때 재배치되는 키의 수가 최소화된다.
- 데이터가 보다 균등하게 분포하게 되므로 수평적 규모 호가장성을 달성하기 쉽다.